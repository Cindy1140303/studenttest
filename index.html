
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒé¡Œç®¡ç†å¹³å°</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Load Lucide icons for responsive design -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* Custom Styles to match the mockup's aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0; /* Light background matching mockup */
        }
        .nav-bar-bg {
            background-color: #e6e6e6; /* Slightly darker gray for the background section */
        }
        .tab-button {
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            margin-right: 0.5rem;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white; /* é è¨­æ–‡å­—é¡è‰²ï¼šç™½è‰² (æœªé»æ“Šç‹€æ…‹) */
        }
        .tab-button::before {
            content: 'â€¢';
            position: absolute;
            left: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.25rem;
            line-height: 1;
            color: white; /* é è¨­å°é»é¡è‰²ï¼šç™½è‰² (æœªé»æ“Šç‹€æ…‹) */
        }
        /* Custom colors for tabs - ONLY set background color now, text color is controlled by .tab-button/.tab-active */
        .tab-green { background-color: #178a48; } /* è€ƒé¡Œåˆ†æ´¾ */
        .tab-blue { background-color: #5284cb; } /* è€ƒé¡Œç®¡ç† */
        .tab-orange { background-color: #ffb230; } /* æ¨¡å¼ç®¡ç† */
        .tab-red { background-color: #ff694d; } /* ç­”é¡Œè¨˜éŒ„ */
        
        /* The active tab has a different look and sets the active color */
        .tab-active {
            z-index: 10;
            margin-top: -1rem; /* Lift up the active tab */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            color: #333; /* é»æ“Šå¾Œæ–‡å­—é¡è‰²ï¼šé»‘è‰²/æ·±ç°è‰² */
        }
        /* Active bullet point color */
        .tab-active::before {
            color: #333; /* é»æ“Šå¾Œå°é»é¡è‰²ï¼šé»‘è‰²/æ·±ç°è‰² */
        }

        .input-style {
            background-color: #fff8e8; /* Light yellowish input background */
            border: 1px solid #ffcc99;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
        }
        .action-button {
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s;
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen flex flex-col">
    <!-- Header/Navigation Bar -->
    <header class="w-full flex flex-col justify-end z-10 pb-0" style="min-height: 120px;">
        <div class="text-center mt-16 mb-16">
            <h1 class="text-4xl font-bold text-gray-800 tracking-wide">è€ƒé¡Œç®¡ç†å¹³å°</h1>
        </div>
        <div class="flex justify-end max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex">
                <button class="tab-button tab-green tab-active" data-tab="assignment" style="--button-color: #178a48;">è€ƒé¡Œåˆ†æ´¾</button>
                <button class="tab-button tab-blue" data-tab="management" style="--button-color: #5284cb;">è€ƒé¡Œç®¡ç†</button>
                <button class="tab-button tab-orange" data-tab="mode" style="--button-color: #ffb230;">æ¨¡å¼ç®¡ç†</button>
                <button class="tab-button tab-red" data-tab="record" style="--button-color: #ff694d;">ç­”é¡Œè¨˜éŒ„</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow nav-bar-bg pt-12 pb-8 px-4 sm:px-6 lg:px-8">
        <div id="content-container" class="max-w-7xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl min-h-[70vh]">
            
            <!-- è€ƒé¡Œåˆ†æ´¾ Tab Content (Default Active) -->
            <div id="tab-assignment" class="active-content">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 hidden">è€ƒé¡Œåˆ†æ´¾</h2>

                <!-- Filter and Action Area (Matching image_8e3546.png) -->
                <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-8 mb-8 p-4 bg-gray-50 rounded-lg">
                    
                    <!-- Dropdown: èª²åˆ¥ (Course) -->
                    <div class="flex items-center space-x-3">
                        <label for="assign-course-select" class="text-gray-600 whitespace-nowrap">èª²åˆ¥</label>
                        <div class="relative">
                            <select id="assign-course-select" class="input-style w-48 appearance-none focus:outline-none focus:ring-2 focus:ring-green-500 pr-10">
                                <option value="">è«‹é¸æ“‡èª²ç¨‹</option>
                            </select>
                            <i data-lucide="chevron-down" class="text-gray-500 absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none w-5 h-5"></i>
                        </div>
                    </div>

                    <!-- Dropdown: è€ƒé¡Œæ¨¡å¼ (Exam Mode) -->
                    <div class="flex items-center space-x-3">
                        <label for="assign-mode-select" class="text-gray-600 whitespace-nowrap">è€ƒé¡Œæ¨¡å¼</label>
                        <div class="relative">
                            <select id="assign-mode-select" class="input-style w-48 appearance-none focus:outline-none focus:ring-2 focus:ring-green-500 pr-10">
                                <option value="">è«‹é¸æ“‡æ¨¡å¼</option>
                            </select>
                            <i data-lucide="chevron-down" class="text-gray-500 absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none w-5 h-5"></i>
                        </div>
                    </div>

                    <!-- Action Button: ç¢ºå®š/é è¦½ (Confirm/Preview) -->
                    <button id="confirm-assignment-button" class="action-button bg-gradient-to-r from-orange-400 to-pink-500 hover:from-orange-500 hover:to-pink-600 text-white md:ml-auto whitespace-nowrap">
                        ç¢ºå®š/é è¦½
                    </button>
                </div>
                
                <!-- è€ƒé¡Œé è¦½å€åŸŸ -->
                <div id="assignment-preview" class="hidden">
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl mb-6 border-2 border-green-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-2xl font-bold text-gray-800">
                                <i data-lucide="clipboard-list" class="inline w-6 h-6 mr-2"></i>
                                è€ƒé¡Œåˆ†æ´¾é è¦½
                            </h3>
                            <div class="text-sm text-gray-600">
                                <span class="font-semibold">èª²ç¨‹:</span> <span id="preview-course" class="text-green-600"></span>
                                <span class="mx-3">|</span>
                                <span class="font-semibold">æ¨¡å¼:</span> <span id="preview-mode" class="text-blue-600"></span>
                                <span class="mx-3">|</span>
                                <span class="font-semibold">é¡Œæ•¸:</span> <span id="preview-count" class="text-purple-600">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- è€ƒé¡Œåˆ—è¡¨ -->
                    <div id="assignment-questions-list" class="space-y-4">
                        <!-- é€™è£¡æœƒå‹•æ…‹è¼‰å…¥è€ƒé¡Œ -->
                    </div>
                </div>

                <!-- åˆå§‹æç¤º -->
                <div id="assignment-placeholder" class="text-gray-500 p-8 border-4 border-dashed border-gray-200 rounded-xl text-center text-lg font-medium bg-white h-64 flex items-center justify-center">
                    é¸æ“‡èª²ç¨‹å’Œè€ƒé¡Œæ¨¡å¼å¾Œ,é»æ“Šã€Œç¢ºå®š/é è¦½ã€å°‡é¡¯ç¤ºç¬¦åˆæ¢ä»¶çš„è€ƒé¡Œæ¸…å–®
                </div>
            </div>

            
            <!-- Question Management Tab Content -->
            <div id="tab-management" class="hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 hidden">è€ƒé¡Œç®¡ç†</h2>

                <!-- Filter and Action Area -->
                <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-6 mb-8 p-4 bg-gray-50 rounded-lg">
                    
                    <!-- Dropdown: èª²åˆ¥ (Course) -->
                    <div class="flex items-center space-x-3">
                        <label for="course-select" class="text-gray-600 whitespace-nowrap">èª²åˆ¥</label>
                        <div class="relative">
                            <select id="course-select" class="input-style w-40 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10">
                                <option value="">è«‹é¸æ“‡èª²ç¨‹</option>
                                <option value="math">æ•¸å­¸</option>
                                <option value="history" selected>æ­·å²</option>
                                <option value="science">ç§‘å­¸</option>
                            </select>
                            <i data-lucide="chevron-down" class="text-gray-500 absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none w-5 h-5"></i>
                        </div>
                    </div>

                    <!-- Dropdown: çŸ¥è­˜é» (Knowledge Point) -->
                    <div class="flex items-center space-x-3">
                        <label for="knowledge-select" class="text-gray-600 whitespace-nowrap">çŸ¥è­˜é»</label>
                        <div class="relative">
                            <select id="knowledge-select" class="input-style w-40 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10">
                                <option value="">è«‹é¸æ“‡çŸ¥è­˜é»</option>
                                <option value="calc">å¾®ç©åˆ†</option>
                                <option value="ancient" selected>å¤ä»£æ–‡æ˜</option>
                            </select>
                            <i data-lucide="chevron-down" class="text-gray-500 absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none w-5 h-5"></i>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row md:ml-auto space-y-3 sm:space-y-0 sm:space-x-3">
                        <button id="query-button" class="action-button bg-gray-200 hover:bg-gray-300 text-gray-700">æŸ¥è©¢</button>
                        <button id="import-button" class="action-button bg-pink-500 hover:bg-pink-600 text-white">åŒ¯å…¥è€ƒé¡Œèˆ‡ç­”æ¡ˆ</button>
                    </div>
                </div>

                <!-- Manual Add Button (Floating/Separated) -->
                <div class="flex justify-end mb-6">
                    <button id="manual-add-button" class="action-button bg-gradient-to-r from-orange-400 to-pink-500 hover:from-orange-500 hover:to-pink-600 text-white">
                        <i data-lucide="plus" class="inline w-5 h-5 mr-2"></i>
                        æ‰‹å‹•æ–°å¢
                    </button>
                </div>
                
                <!-- Data Table -->
                <div class="overflow-x-auto rounded-lg shadow-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-600 text-white">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">åŒ¯å…¥æ—¥æœŸ</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">èª²åˆ¥</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">ç« ç¯€</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">çŸ¥è­˜é»</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">é¡Œå‹</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">é¸é …</th>
                                <th class="px-3 py-3 text-left text-xs font-medium uppercase tracking-wider">ç­”æ¡ˆ</th>
                                <th class="px-3 py-3 text-center text-xs font-medium uppercase tracking-wider">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="question-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Mock data will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æ¨¡å¼ç®¡ç† Tab Content (Matching image_8e3562.png) -->
            <div id="tab-mode" class="hidden">
                <h3 class="text-xl font-semibold mb-8 text-gray-800 text-center">äº’å‹•è€ƒé¡Œæ¨¡å¼å®šç¾© (VUE Code)</h3>

                <div class="space-y-12">
                    
                    <!-- Mode 1: é€£é€£çœ‹ (Connect-the-Dots) -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start p-4 border border-gray-200 rounded-xl bg-gray-50">
                        <div class="flex items-start space-x-4">
                            <span class="text-2xl font-mono pt-1 text-gray-500 w-8 text-right">1.</span>
                            <div class="flex-grow">
                                <label class="text-sm font-medium text-gray-600 mb-2 block">HTML/JS/CSS code(VUE)</label>
                                <textarea id="mode-code-1" class="input-style w-full h-40 focus:outline-none focus:ring-2 focus:ring-orange-500 p-3 text-sm font-mono resize-none" placeholder="åœ¨æ­¤è¼¸å…¥ VUE å–®æª”æ¡ˆçµ„ä»¶ä»£ç¢¼ï¼ˆé€£é€£çœ‹æ¨¡å¼ï¼‰..."></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600 mb-2 block">å°æ‡‰æ¨¡å¼åç¨±</label>
                            <input id="mode-name-1" type="text" value="é€£é€£çœ‹" class="input-style w-full text-lg font-bold text-center py-4 bg-yellow-200 border-yellow-500 text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>
                    </div>

                    <!-- Mode 2: æ‹–æ‹‰æ–¹å¡Š (Drag Blocks) -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start p-4 border border-gray-200 rounded-xl bg-gray-50">
                        <div class="flex items-start space-x-4">
                            <span class="text-2xl font-mono pt-1 text-gray-500 w-8 text-right">2.</span>
                            <div class="flex-grow">
                                <label class="text-sm font-medium text-gray-600 mb-2 block">HTML/JS/CSS code(VUE)</label>
                                <textarea id="mode-code-2" class="input-style w-full h-40 focus:outline-none focus:ring-2 focus:ring-orange-500 p-3 text-sm font-mono resize-none" placeholder="åœ¨æ­¤è¼¸å…¥ VUE å–®æª”æ¡ˆçµ„ä»¶ä»£ç¢¼ï¼ˆæ‹–æ‹‰æ–¹å¡Šæ¨¡å¼ï¼‰..."></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600 mb-2 block">å°æ‡‰æ¨¡å¼åç¨±</label>
                            <input id="mode-name-2" type="text" value="æ‹–æ‹‰æ–¹å¡Š" class="input-style w-full text-lg font-bold text-center py-4 bg-yellow-200 border-yellow-500 text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>
                    </div>
                    
                    <!-- Mode 3: å–®é¸é¡Œ (Single Choice) -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start p-4 border border-gray-200 rounded-xl bg-gray-50">
                        <div class="flex items-start space-x-4">
                            <span class="text-2xl font-mono pt-1 text-gray-500 w-8 text-right">3.</span>
                            <div class="flex-grow">
                                <label class="text-sm font-medium text-gray-600 mb-2 block">HTML/JS/CSS code(VUE)</label>
                                <textarea id="mode-code-3" class="input-style w-full h-40 focus:outline-none focus:ring-2 focus:ring-orange-500 p-3 text-sm font-mono resize-none" placeholder="åœ¨æ­¤è¼¸å…¥ VUE å–®æª”æ¡ˆçµ„ä»¶ä»£ç¢¼ï¼ˆå–®é¸é¡Œæ¨¡å¼ï¼‰..."></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600 mb-2 block">å°æ‡‰æ¨¡å¼åç¨±</label>
                            <input id="mode-name-3" type="text" value="å–®é¸é¡Œ" class="input-style w-full text-lg font-bold text-center py-4 bg-yellow-200 border-yellow-500 text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        </div>
                    </div>

                    <!-- å„²å­˜æŒ‰éˆ• -->
                    <div class="flex justify-center mt-8">
                        <button id="save-modes-button" class="action-button bg-gradient-to-r from-orange-400 to-pink-500 hover:from-orange-500 hover:to-pink-600 text-white px-12 py-4 text-lg">
                            <i data-lucide="save" class="inline w-5 h-5 mr-2"></i>
                            å„²å­˜æ‰€æœ‰æ¨¡å¼
                        </button>
                    </div>
                </div>
            </div>

            <!-- ç­”é¡Œè¨˜éŒ„ Tab Content -->
            <div id="tab-record" class="hidden text-center p-12 text-gray-500">
                <i data-lucide="clipboard-list" class="w-16 h-16 mx-auto mb-4"></i>
                <p class="text-xl">é€™æ˜¯ã€Œç­”é¡Œè¨˜éŒ„ã€çš„å…§å®¹ï¼Œç”¨æ–¼æŸ¥çœ‹å­¸ç”Ÿçš„ä½œç­”æ­·å²ã€‚</p>
            </div>

        </div>

        <!-- Message Box for alerts/confirmation (placed outside the main content block) -->
        <div id="message-box" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl max-w-sm w-full text-center">
                <p id="message-text" class="text-lg font-medium mb-4 text-gray-700"></p>
                <button id="message-confirm" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold w-full">ç¢ºå®š</button>
            </div>
        </div>

        <!-- æ‰‹å‹•æ–°å¢è€ƒé¡Œè¡¨å–® -->
        <div id="add-question-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <h3 class="text-2xl font-bold mb-6 text-gray-800">æ‰‹å‹•æ–°å¢è€ƒé¡Œ</h3>
                <form id="add-question-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">èª²åˆ¥ *</label>
                            <input type="text" id="new-course" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šæ•¸å­¸">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç« ç¯€ *</label>
                            <input type="text" id="new-chapter" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šç¬¬1ç« ">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">çŸ¥è­˜é» *</label>
                        <input type="text" id="new-knowledge" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šä»£æ•¸">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡Œå‹ *</label>
                        <select id="new-type" required class="input-style w-full">
                            <option value="">è«‹é¸æ“‡é¡Œå‹</option>
                            <option value="å–®é¸é¡Œ">å–®é¸é¡Œ</option>
                            <option value="å¤šé¸é¡Œ">å¤šé¸é¡Œ</option>
                            <option value="æ˜¯éé¡Œ">æ˜¯éé¡Œ</option>
                            <option value="å¡«ç©ºé¡Œ">å¡«ç©ºé¡Œ</option>
                            <option value="é€£é€£çœ‹">é€£é€£çœ‹</option>
                            <option value="æ‹–æ‹‰æ–¹å¡Š">æ‹–æ‹‰æ–¹å¡Š</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡Œç›®å…§å®¹ *</label>
                        <textarea id="new-content" required class="input-style w-full h-24" placeholder="è«‹è¼¸å…¥é¡Œç›®å…§å®¹"></textarea>
                    </div>
                    <div id="new-options-container">
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¸é … *</label>
                        <textarea id="new-options" required class="input-style w-full h-32 font-mono text-sm" placeholder="ç­‰å¾…é¸æ“‡é¡Œå‹..."></textarea>
                        <div id="new-options-help" class="text-xs text-gray-500 mt-2 bg-blue-50 p-3 rounded">
                            <p class="font-semibold mb-1">ğŸ“Œ æ ¼å¼èªªæ˜:</p>
                            <p id="new-format-hint">è«‹å…ˆé¸æ“‡é¡Œå‹</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç­”æ¡ˆ *</label>
                        <input type="text" id="new-answer" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šB">
                        <p id="new-answer-help" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">
                            ç¢ºå®šæ–°å¢
                        </button>
                        <button type="button" id="cancel-add-button" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg font-semibold">
                            å–æ¶ˆ
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ç·¨è¼¯è€ƒé¡Œè¡¨å–® -->
        <div id="edit-question-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <h3 class="text-2xl font-bold mb-6 text-gray-800">ç·¨è¼¯è€ƒé¡Œ</h3>
                <form id="edit-question-form" class="space-y-4">
                    <input type="hidden" id="edit-question-id">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">èª²åˆ¥ *</label>
                            <input type="text" id="edit-course" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šæ•¸å­¸">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç« ç¯€ *</label>
                            <input type="text" id="edit-chapter" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šç¬¬1ç« ">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">çŸ¥è­˜é» *</label>
                        <input type="text" id="edit-knowledge" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šä»£æ•¸">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡Œå‹ *</label>
                        <select id="edit-type" required class="input-style w-full">
                            <option value="">è«‹é¸æ“‡é¡Œå‹</option>
                            <option value="å–®é¸é¡Œ">å–®é¸é¡Œ</option>
                            <option value="å¤šé¸é¡Œ">å¤šé¸é¡Œ</option>
                            <option value="æ˜¯éé¡Œ">æ˜¯éé¡Œ</option>
                            <option value="å¡«ç©ºé¡Œ">å¡«ç©ºé¡Œ</option>
                            <option value="é€£é€£çœ‹">é€£é€£çœ‹</option>
                            <option value="æ‹–æ‹‰æ–¹å¡Š">æ‹–æ‹‰æ–¹å¡Š</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡Œç›®å…§å®¹ *</label>
                        <textarea id="edit-content" required class="input-style w-full h-24" placeholder="è«‹è¼¸å…¥é¡Œç›®å…§å®¹"></textarea>
                    </div>
                    <div id="edit-options-container">
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¸é … *</label>
                        <textarea id="edit-options" required class="input-style w-full h-32 font-mono text-sm" placeholder="ç­‰å¾…é¸æ“‡é¡Œå‹..."></textarea>
                        <div id="edit-options-help" class="text-xs text-gray-500 mt-2 bg-blue-50 p-3 rounded">
                            <p class="font-semibold mb-1">ğŸ“Œ æ ¼å¼èªªæ˜:</p>
                            <p id="edit-format-hint">è«‹å…ˆé¸æ“‡é¡Œå‹</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç­”æ¡ˆ *</label>
                        <input type="text" id="edit-answer" required class="input-style w-full" placeholder="ä¾‹å¦‚ï¼šB">
                        <p id="edit-answer-help" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">
                            ç¢ºå®šæ›´æ–°
                        </button>
                        <button type="button" id="cancel-edit-button" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg font-semibold">
                            å–æ¶ˆ
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Excel åŒ¯å…¥è¡¨å–® -->
        <div id="import-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow-2xl max-w-lg w-full">
                <h3 class="text-2xl font-bold mb-6 text-gray-800">åŒ¯å…¥ Excel æª”æ¡ˆ</h3>
                <div class="space-y-4">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                        <input type="file" id="excel-file-input" accept=".xlsx,.xls,.csv" class="hidden">
                        <label for="excel-file-input" class="cursor-pointer">
                            <i data-lucide="upload" class="w-12 h-12 mx-auto mb-4 text-gray-400"></i>
                            <p class="text-lg font-medium text-gray-700 mb-2">é»æ“Šä¸Šå‚³ Excel æª”æ¡ˆ</p>
                            <p class="text-sm text-gray-500">æ”¯æ´æ ¼å¼ï¼š.xlsx, .xls, .csv</p>
                        </label>
                        <p id="file-name" class="mt-4 text-sm text-gray-600"></p>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800 font-medium mb-2">ğŸ“‹ Excel æ ¼å¼èªªæ˜ï¼š</p>
                        <p class="text-xs text-blue-700">ç¬¬ä¸€è¡Œç‚ºæ¨™é¡Œï¼šèª²åˆ¥ã€ç« ç¯€ã€çŸ¥è­˜é»ã€é¡Œå‹ã€é¡Œç›®å…§å®¹ã€é¸é …ã€ç­”æ¡ˆ</p>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button id="confirm-import-button" disabled class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                            ç¢ºå®šåŒ¯å…¥
                        </button>
                        <button id="cancel-import-button" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg font-semibold">
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // Initialize Lucide Icons
    lucide.createIcons();

    // API åŸºç¤ URLï¼ˆé–‹ç™¼æ™‚ä½¿ç”¨æœ¬åœ°ï¼Œéƒ¨ç½²æ™‚æ”¹ç‚ºå¯¦éš› API åœ°å€ï¼‰
    const API_BASE_URL = 'https://studenttest.vercel.app/api';
    
    // å‚™ç”¨å‡è³‡æ–™ï¼ˆç•¶å¾Œç«¯ç„¡æ³•é€£æ¥æ™‚ä½¿ç”¨ï¼‰
    const mockQuestions = [
        { id: '1', date: '2025/01/10', course: 'æ•¸å­¸', chapter: 'ç¬¬3ç« ', knowledge: 'å¾®ç©åˆ†', type: 'å–®é¸é¡Œ', options: 'A. 2,B. 4,C. 8,D. 16', answer: 'B' },
        { id: '2', date: '2025/01/10', course: 'æ­·å²', chapter: 'ç¬¬5ç« ', knowledge: 'å¤ä»£æ–‡æ˜', type: 'é€£é€£çœ‹', options: '4çµ„', answer: 'è¦‹åœ–' },
        { id: '3', date: '2025/01/11', course: 'ç§‘å­¸', chapter: 'ç¬¬1ç« ', knowledge: 'ç‰©ç†å­¸', type: 'æ˜¯éé¡Œ', options: 'æ˜¯,å¦', answer: 'æ˜¯' },
        { id: '4', date: '2025/01/11', course: 'æ•¸å­¸', chapter: 'ç¬¬1ç« ', knowledge: 'ä»£æ•¸', type: 'å–®é¸é¡Œ', options: 'A. 3,B. 4,C. 5,D. 6', answer: 'B' },
        { id: '5', date: '2025/01/12', course: 'æ­·å²', chapter: 'ç¬¬2ç« ', knowledge: 'è¿‘ä»£å²', type: 'å–®é¸é¡Œ', options: 'A. 1912,B. 1914,C. 1916,D. 1918', answer: 'B' }
    ];

    // å„²å­˜å¾ API å–å¾—çš„è€ƒé¡Œè³‡æ–™
    let questionsData = [];

    const tableBody = document.getElementById('question-table-body');
    const tabButtons = document.querySelectorAll('.tab-button');
    const contentContainer = document.getElementById('content-container');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');
    const messageConfirm = document.getElementById('message-confirm');

    // Function to show custom message box
    function showMessage(text) {
        messageText.textContent = text;
        messageBox.classList.remove('hidden');
        messageBox.classList.add('flex');
    }

    // Event listener for message box confirmation
    messageConfirm.addEventListener('click', () => {
        messageBox.classList.add('hidden');
        messageBox.classList.remove('flex');
    });

    // å¾ API å–å¾—è€ƒé¡Œè³‡æ–™
    async function fetchQuestions(filters = {}) {
        try {
            // å»ºç«‹æŸ¥è©¢åƒæ•¸
            const queryParams = new URLSearchParams();
            if (filters.course) queryParams.append('course', filters.course);
            if (filters.knowledge) queryParams.append('knowledge', filters.knowledge);
            if (filters.chapter) queryParams.append('chapter', filters.chapter);
            
            const url = `${API_BASE_URL}/questions${queryParams.toString() ? '?' + queryParams.toString() : ''}`;
            const response = await fetch(url);
            const result = await response.json();
            
            if (result.success) {
                questionsData = result.data;
                renderQuestions();
                console.log(`âœ… æˆåŠŸå¾å¾Œç«¯ API è¼‰å…¥ ${result.data.length} ç­†è€ƒé¡Œè³‡æ–™`);
            } else {
                throw new Error(result.message || 'è¼‰å…¥å¤±æ•—');
            }
        } catch (error) {
            console.warn('âš ï¸ ç„¡æ³•é€£æ¥å¾Œç«¯ APIï¼Œä½¿ç”¨ç¤ºç¯„è³‡æ–™:', error.message);
            // ä½¿ç”¨å‚™ç”¨å‡è³‡æ–™
            questionsData = mockQuestions;
            renderQuestions();
        }
    }

    // Render Table Data for 'è€ƒé¡Œç®¡ç†' tab
    function renderQuestions() {
        tableBody.innerHTML = ''; // Clear existing rows
        
        if (questionsData.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="8" class="px-3 py-8 text-center text-gray-500">
                        <p class="text-lg">æš«ç„¡è€ƒé¡Œè³‡æ–™</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        questionsData.forEach((q, index) => {
            const row = document.createElement('tr');
            row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
            const questionId = q._id || q.id;
            
            row.innerHTML = `
                <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${q.date || 'æœªè¨­å®š'}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.course}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.chapter || '-'}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.knowledge || '-'}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.type}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.options || '-'}</td>
                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${q.answer}</td>
                <td class="px-3 py-4 whitespace-nowrap text-center text-sm font-medium">
                    <div class="flex items-center justify-center space-x-2">
                        <!-- Edit Button -->
                        <button onclick="handleAction('edit', '${questionId}')" class="text-blue-500 hover:text-blue-700 p-2 rounded-full hover:bg-blue-100 transition">
                            <i data-lucide="pencil" class="w-5 h-5"></i>
                        </button>
                        <!-- Delete Button -->
                        <button onclick="handleAction('delete', '${questionId}')" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-100 transition">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
        // Re-initialize icons for newly added table rows
        lucide.createIcons();
    }

    // Handle Edit/Delete Actions (for 'è€ƒé¡Œç®¡ç†')
    window.handleAction = async function(action, questionId) {
        const question = questionsData.find(q => q.id === questionId || q._id === questionId);
        if (!question) return;
        
        if (action === 'edit') {
            // é–‹å•Ÿç·¨è¼¯è¦–çª—ä¸¦å¡«å…¥è³‡æ–™
            openEditModal(question);
        } else if (action === 'delete') {
            if (confirm(`ç¢ºèªè¦åˆªé™¤ï¼š${question.course} - ${question.type} è€ƒé¡Œå—ï¼Ÿ`)) {
                try {
                    const response = await fetch(`${API_BASE_URL}/questions/${questionId}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        showMessage('åˆªé™¤æˆåŠŸï¼');
                        fetchQuestions(); // é‡æ–°è¼‰å…¥è³‡æ–™
                    } else {
                        showMessage('åˆªé™¤å¤±æ•—ï¼š' + result.message);
                    }
                } catch (error) {
                    showMessage('åˆªé™¤å¤±æ•—ï¼š' + error.message);
                }
            }
        }
    }

    // é–‹å•Ÿç·¨è¼¯è¦–çª—
    function openEditModal(question) {
        const editModal = document.getElementById('edit-question-modal');
        
        // å¡«å…¥ç¾æœ‰è³‡æ–™
        document.getElementById('edit-question-id').value = question._id || question.id;
        document.getElementById('edit-course').value = question.course || '';
        document.getElementById('edit-chapter').value = question.chapter || '';
        document.getElementById('edit-knowledge').value = question.knowledge || '';
        document.getElementById('edit-type').value = question.type || '';
        document.getElementById('edit-content').value = question.content || '';
        document.getElementById('edit-options').value = question.options || '';
        document.getElementById('edit-answer').value = question.answer || '';
        
        editModal.classList.remove('hidden');
        editModal.classList.add('flex');
    }

    // ç·¨è¼¯è¡¨å–®æäº¤
    const editQuestionForm = document.getElementById('edit-question-form');
    editQuestionForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const questionId = document.getElementById('edit-question-id').value;
        const questionData = {
            course: document.getElementById('edit-course').value,
            chapter: document.getElementById('edit-chapter').value,
            knowledge: document.getElementById('edit-knowledge').value,
            type: document.getElementById('edit-type').value,
            content: document.getElementById('edit-content').value,
            options: document.getElementById('edit-options').value,
            answer: document.getElementById('edit-answer').value
        };
        
        try {
            const response = await fetch(`${API_BASE_URL}/questions/${questionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(questionData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showMessage('âœ… è€ƒé¡Œæ›´æ–°æˆåŠŸï¼');
                editModal.classList.add('hidden');
                editModal.classList.remove('flex');
                fetchQuestions(); // é‡æ–°è¼‰å…¥è³‡æ–™
            } else {
                showMessage('âŒ æ›´æ–°å¤±æ•—ï¼š' + result.message);
            }
        } catch (error) {
            showMessage('âŒ æ›´æ–°å¤±æ•—ï¼š' + error.message);
        }
    });

    // å–æ¶ˆç·¨è¼¯æŒ‰éˆ•
    const cancelEditBtn = document.getElementById('cancel-edit-button');
    const editModal = document.getElementById('edit-question-modal');
    cancelEditBtn.addEventListener('click', function() {
        editModal.classList.add('hidden');
        editModal.classList.remove('flex');
    });

    // Tab Switching Logic
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-tab');

            // 1. Update Tab Visuals
            tabButtons.forEach(btn => {
                btn.classList.remove('tab-active');
                btn.style.marginTop = '0';
            });
            button.classList.add('tab-active');
            button.style.marginTop = '-1rem';

            // 2. Switch Content
            document.querySelectorAll('#content-container > div').forEach(content => {
                if (content.id === `tab-${targetTab}`) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
            
            // Re-render table when switching back to management (optional, but good practice for dynamic data)
            if (targetTab === 'management') {
                fetchQuestions(); // å¾ API è¼‰å…¥è³‡æ–™
            }
        });
    });

    // ========== æ–°åŠŸèƒ½ï¼šæŸ¥è©¢æŒ‰éˆ• ==========
    document.getElementById('query-button').addEventListener('click', function() {
        const course = document.getElementById('course-select').value;
        const knowledge = document.getElementById('knowledge-select').value;
        
        const filters = {};
        if (course) filters.course = course;
        if (knowledge) filters.knowledge = knowledge;
        
        fetchQuestions(filters);
        showMessage('æŸ¥è©¢ä¸­...');
    });

    // ========== é¡Œå‹æ ¼å¼èªªæ˜ ==========
    const questionTypeFormats = {
        'å–®é¸é¡Œ': {
            optionsPlaceholder: 'A. é¸é …1\nB. é¸é …2\nC. é¸é …3\nD. é¸é …4',
            optionsHint: 'å–®é¸é¡Œ: æ¯è¡Œä¸€å€‹é¸é …ï¼Œæ ¼å¼ç‚ºã€Œé¸é …ç·¨è™Ÿ. å…§å®¹ã€',
            answerHint: 'å¡«å…¥æ­£ç¢ºé¸é …çš„ç·¨è™Ÿï¼Œä¾‹å¦‚: A æˆ– B'
        },
        'å¤šé¸é¡Œ': {
            optionsPlaceholder: 'A. é¸é …1\nB. é¸é …2\nC. é¸é …3\nD. é¸é …4',
            optionsHint: 'å¤šé¸é¡Œ: æ¯è¡Œä¸€å€‹é¸é …ï¼Œæ ¼å¼ç‚ºã€Œé¸é …ç·¨è™Ÿ. å…§å®¹ã€',
            answerHint: 'å¡«å…¥æ‰€æœ‰æ­£ç¢ºé¸é …ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼Œä¾‹å¦‚: A,C'
        },
        'æ˜¯éé¡Œ': {
            optionsPlaceholder: 'A. æ˜¯\nB. å¦',
            optionsHint: 'æ˜¯éé¡Œ: å›ºå®šç‚ºã€Œæ˜¯ã€å’Œã€Œå¦ã€å…©å€‹é¸é …',
            answerHint: 'å¡«å…¥ A æˆ– B'
        },
        'å¡«ç©ºé¡Œ': {
            optionsPlaceholder: '(å¯ç•™ç©ºæˆ–å¡«å…¥æç¤º)',
            optionsHint: 'å¡«ç©ºé¡Œ: å¯ä¸å¡«é¸é …ï¼Œæˆ–å¡«å…¥ç­”æ¡ˆæç¤º',
            answerHint: 'å¡«å…¥æ¨™æº–ç­”æ¡ˆ'
        },
        'é€£é€£çœ‹': {
            optionsPlaceholder: 'è˜‹æœ|Apple\né¦™è•‰|Banana\nè²“|Cat\nç‹—|Dog',
            optionsHint: 'é€£é€£çœ‹: æ¯è¡Œä¸€çµ„é…å°ï¼Œç”¨ã€Œ|ã€ç¬¦è™Ÿåˆ†éš”å·¦å³å…©å´ï¼Œä¾‹å¦‚: ä¸­æ–‡|è‹±æ–‡',
            answerHint: 'å¡«å…¥ auto (ç³»çµ±è‡ªå‹•é©—è­‰é…å°æ­£ç¢ºæ€§)'
        },
        'æ‹–æ‹‰æ–¹å¡Š': {
            optionsPlaceholder: 'æ–¹å¡Š1å…§å®¹|ç›®æ¨™ä½ç½®1\næ–¹å¡Š2å…§å®¹|ç›®æ¨™ä½ç½®2',
            optionsHint: 'æ‹–æ‹‰æ–¹å¡Š: æ¯è¡Œä¸€çµ„ï¼Œç”¨ã€Œ|ã€åˆ†éš”æ–¹å¡Šå…§å®¹å’Œç›®æ¨™ä½ç½®',
            answerHint: 'å¡«å…¥ auto (ç³»çµ±è‡ªå‹•é©—è­‰)'
        }
    };

    // æ›´æ–°é¡Œå‹æ ¼å¼æç¤ºï¼ˆæ–°å¢è¡¨å–®ï¼‰
    document.getElementById('new-type').addEventListener('change', function() {
        const selectedType = this.value;
        const optionsField = document.getElementById('new-options');
        const formatHint = document.getElementById('new-format-hint');
        const answerHelp = document.getElementById('new-answer-help');
        const answerField = document.getElementById('new-answer');
        
        if (selectedType && questionTypeFormats[selectedType]) {
            const format = questionTypeFormats[selectedType];
            optionsField.placeholder = format.optionsPlaceholder;
            formatHint.textContent = format.optionsHint;
            answerHelp.textContent = format.answerHint;
            
            // ç‚ºé€£é€£çœ‹å’Œæ‹–æ‹‰æ–¹å¡Šè‡ªå‹•å¡«å…¥ auto
            if (selectedType === 'é€£é€£çœ‹' || selectedType === 'æ‹–æ‹‰æ–¹å¡Š') {
                answerField.value = 'auto';
            } else {
                answerField.value = '';
            }
        } else {
            optionsField.placeholder = 'è«‹å…ˆé¸æ“‡é¡Œå‹';
            formatHint.textContent = 'è«‹å…ˆé¸æ“‡é¡Œå‹';
            answerHelp.textContent = '';
        }
    });

    // æ›´æ–°é¡Œå‹æ ¼å¼æç¤ºï¼ˆç·¨è¼¯è¡¨å–®ï¼‰
    document.getElementById('edit-type').addEventListener('change', function() {
        const selectedType = this.value;
        const optionsField = document.getElementById('edit-options');
        const formatHint = document.getElementById('edit-format-hint');
        const answerHelp = document.getElementById('edit-answer-help');
        const answerField = document.getElementById('edit-answer');
        
        if (selectedType && questionTypeFormats[selectedType]) {
            const format = questionTypeFormats[selectedType];
            optionsField.placeholder = format.optionsPlaceholder;
            formatHint.textContent = format.optionsHint;
            answerHelp.textContent = format.answerHint;
            
            // ç‚ºé€£é€£çœ‹å’Œæ‹–æ‹‰æ–¹å¡Šè‡ªå‹•å¡«å…¥ auto
            if (selectedType === 'é€£é€£çœ‹' || selectedType === 'æ‹–æ‹‰æ–¹å¡Š') {
                if (!answerField.value || answerField.value === '') {
                    answerField.value = 'auto';
                }
            }
        } else {
            optionsField.placeholder = 'è«‹å…ˆé¸æ“‡é¡Œå‹';
            formatHint.textContent = 'è«‹å…ˆé¸æ“‡é¡Œå‹';
            answerHelp.textContent = '';
        }
    });

    // ========== æ–°åŠŸèƒ½ï¼šæ‰‹å‹•æ–°å¢æŒ‰éˆ• ==========
    const addModal = document.getElementById('add-question-modal');
    const addForm = document.getElementById('add-question-form');
    
    document.getElementById('manual-add-button').addEventListener('click', function() {
        addModal.classList.remove('hidden');
        addModal.classList.add('flex');
        lucide.createIcons();
    });
    
    document.getElementById('cancel-add-button').addEventListener('click', function() {
        addModal.classList.add('hidden');
        addModal.classList.remove('flex');
        addForm.reset();
    });
    
    addForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const newQuestion = {
            course: document.getElementById('new-course').value,
            chapter: document.getElementById('new-chapter').value,
            knowledge: document.getElementById('new-knowledge').value,
            type: document.getElementById('new-type').value,
            content: document.getElementById('new-content').value,
            options: document.getElementById('new-options').value,
            answer: document.getElementById('new-answer').value
        };
        
        try {
            const response = await fetch(`${API_BASE_URL}/questions`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newQuestion)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showMessage('âœ… è€ƒé¡Œæ–°å¢æˆåŠŸï¼');
                addModal.classList.add('hidden');
                addModal.classList.remove('flex');
                addForm.reset();
                fetchQuestions(); // é‡æ–°è¼‰å…¥è³‡æ–™
            } else {
                showMessage('âŒ æ–°å¢å¤±æ•—ï¼š' + result.message);
            }
        } catch (error) {
            showMessage('âŒ æ–°å¢å¤±æ•—ï¼š' + error.message);
        }
    });

    // ========== æ–°åŠŸèƒ½ï¼šExcel åŒ¯å…¥ ==========
    const importModal = document.getElementById('import-modal');
    const fileInput = document.getElementById('excel-file-input');
    const fileName = document.getElementById('file-name');
    const confirmImportBtn = document.getElementById('confirm-import-button');
    let selectedFile = null;
    
    document.getElementById('import-button').addEventListener('click', function() {
        importModal.classList.remove('hidden');
        importModal.classList.add('flex');
        lucide.createIcons();
    });
    
    document.getElementById('cancel-import-button').addEventListener('click', function() {
        importModal.classList.add('hidden');
        importModal.classList.remove('flex');
        fileInput.value = '';
        fileName.textContent = '';
        selectedFile = null;
        confirmImportBtn.disabled = true;
    });
    
    fileInput.addEventListener('change', function(e) {
        selectedFile = e.target.files[0];
        if (selectedFile) {
            fileName.textContent = `å·²é¸æ“‡ï¼š${selectedFile.name}`;
            confirmImportBtn.disabled = false;
        }
    });
    
    confirmImportBtn.addEventListener('click', async function() {
        if (!selectedFile) {
            showMessage('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
            return;
        }
        
        const formData = new FormData();
        formData.append('file', selectedFile);
        
        try {
            const response = await fetch(`${API_BASE_URL}/questions/import`, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                showMessage(`âœ… æˆåŠŸåŒ¯å…¥ ${result.imported || 0} ç­†è€ƒé¡Œï¼`);
                importModal.classList.add('hidden');
                importModal.classList.remove('flex');
                fileInput.value = '';
                fileName.textContent = '';
                selectedFile = null;
                confirmImportBtn.disabled = true;
                fetchQuestions(); // é‡æ–°è¼‰å…¥è³‡æ–™
            } else {
                showMessage('âŒ åŒ¯å…¥å¤±æ•—ï¼š' + result.message);
            }
        } catch (error) {
            showMessage('âŒ åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
        }
    });

    // ========== è€ƒé¡Œåˆ†æ´¾åŠŸèƒ½ ==========
    let allQuestions = []; // å„²å­˜æ‰€æœ‰è€ƒé¡Œ
    let allModes = []; // å„²å­˜æ‰€æœ‰æ¨¡å¼

    // è¼‰å…¥è€ƒé¡Œåˆ†æ´¾æ‰€éœ€è³‡æ–™
    async function loadAssignmentData() {
        try {
            // åŒæ™‚è¼‰å…¥è€ƒé¡Œå’Œæ¨¡å¼
            const [questionsRes, modesRes] = await Promise.all([
                fetch(`${API_BASE_URL}/questions`),
                fetch(`${API_BASE_URL}/modes`)
            ]);
            
            const questionsData = await questionsRes.json();
            const modesData = await modesRes.json();
            
            if (questionsData.success) {
                allQuestions = questionsData.data;
                populateAssignmentCourses();
            }
            
            if (modesData.success) {
                allModes = modesData.data;
                populateAssignmentModes();
            }
            
            console.log('âœ… è€ƒé¡Œåˆ†æ´¾è³‡æ–™è¼‰å…¥å®Œæˆ');
        } catch (error) {
            console.warn('âš ï¸ ç„¡æ³•è¼‰å…¥è€ƒé¡Œåˆ†æ´¾è³‡æ–™:', error.message);
        }
    }

    // å¡«å……èª²ç¨‹ä¸‹æ‹‰é¸å–®
    function populateAssignmentCourses() {
        const courseSelect = document.getElementById('assign-course-select');
        const courses = [...new Set(allQuestions.map(q => q.course))].filter(Boolean);
        
        courseSelect.innerHTML = '<option value="">è«‹é¸æ“‡èª²ç¨‹</option>';
        courses.forEach(course => {
            const option = document.createElement('option');
            option.value = course;
            option.textContent = course;
            courseSelect.appendChild(option);
        });
    }

    // å¡«å……æ¨¡å¼ä¸‹æ‹‰é¸å–®
    function populateAssignmentModes() {
        const modeSelect = document.getElementById('assign-mode-select');
        
        modeSelect.innerHTML = '<option value="">è«‹é¸æ“‡æ¨¡å¼</option>';
        allModes.forEach(mode => {
            const option = document.createElement('option');
            option.value = mode.name;
            option.textContent = mode.name;
            modeSelect.appendChild(option);
        });
    }

    // ç¢ºå®š/é è¦½æŒ‰éˆ•äº‹ä»¶
    document.getElementById('confirm-assignment-button').addEventListener('click', function() {
        const selectedCourse = document.getElementById('assign-course-select').value;
        const selectedMode = document.getElementById('assign-mode-select').value;
        
        if (!selectedCourse) {
            showMessage('âš ï¸ è«‹é¸æ“‡èª²ç¨‹');
            return;
        }
        
        if (!selectedMode) {
            showMessage('âš ï¸ è«‹é¸æ“‡è€ƒé¡Œæ¨¡å¼');
            return;
        }
        
        // ç¯©é¸ç¬¦åˆæ¢ä»¶çš„è€ƒé¡Œ
        const filteredQuestions = allQuestions.filter(q => 
            q.course === selectedCourse && q.type === selectedMode
        );
        
        if (filteredQuestions.length === 0) {
            showMessage(`âŒ æ²’æœ‰æ‰¾åˆ°ç¬¦åˆã€Œ${selectedCourse} - ${selectedMode}ã€çš„è€ƒé¡Œ`);
            return;
        }
        
        // é¡¯ç¤ºè€ƒé¡Œé è¦½
        displayAssignmentPreview(selectedCourse, selectedMode, filteredQuestions);
    });

    // é¡¯ç¤ºè€ƒé¡Œé è¦½
    function displayAssignmentPreview(course, mode, questions) {
        const placeholder = document.getElementById('assignment-placeholder');
        const preview = document.getElementById('assignment-preview');
        const questionsList = document.getElementById('assignment-questions-list');
        
        // éš±è—æç¤º,é¡¯ç¤ºé è¦½
        placeholder.classList.add('hidden');
        preview.classList.remove('hidden');
        
        // æ›´æ–°é è¦½è³‡è¨Š
        document.getElementById('preview-course').textContent = course;
        document.getElementById('preview-mode').textContent = mode;
        document.getElementById('preview-count').textContent = questions.length;
        
        // æ¸²æŸ“è€ƒé¡Œåˆ—è¡¨
        questionsList.innerHTML = '';
        questions.forEach((q, index) => {
            const questionCard = document.createElement('div');
            questionCard.className = 'bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500 hover:shadow-lg transition';
            
            questionCard.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-3">
                            <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold mr-3">ç¬¬ ${index + 1} é¡Œ</span>
                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">${q.type}</span>
                            ${q.chapter ? `<span class="ml-2 text-gray-500 text-sm">${q.chapter}</span>` : ''}
                            ${q.knowledge ? `<span class="ml-2 text-gray-500 text-sm">ãƒ»${q.knowledge}</span>` : ''}
                        </div>
                        <div class="text-gray-800 font-medium mb-3 text-lg">${q.content || 'é¡Œç›®å…§å®¹'}</div>
                        ${q.options ? `
                            <div class="bg-gray-50 p-4 rounded-lg mb-3">
                                <div class="text-sm text-gray-600 mb-2 font-semibold">é¸é …ï¼š</div>
                                <div class="text-gray-700">${formatOptions(q.options)}</div>
                            </div>
                        ` : ''}
                        <div class="flex items-center text-sm">
                            <span class="text-gray-500 mr-2">æ­£ç¢ºç­”æ¡ˆï¼š</span>
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded font-semibold">${q.answer || 'æœªè¨­å®š'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            questionsList.appendChild(questionCard);
        });
        
        // é‡æ–°åˆå§‹åŒ–åœ–ç¤º
        lucide.createIcons();
    }

    // æ ¼å¼åŒ–é¸é …é¡¯ç¤º
    function formatOptions(options) {
        if (!options) return '';
        
        // å¦‚æœæ˜¯å­—ä¸²,å˜—è©¦åˆ†å‰²
        if (typeof options === 'string') {
            if (options.includes(',')) {
                return options.split(',').map((opt, i) => 
                    `<div class="mb-1">${opt.trim()}</div>`
                ).join('');
            }
            return options;
        }
        
        // å¦‚æœæ˜¯ç‰©ä»¶æˆ–é™£åˆ—
        return JSON.stringify(options);
    }

    // ========== æ¨¡å¼ç®¡ç†åŠŸèƒ½ ==========
    
    // è¼‰å…¥å·²å„²å­˜çš„æ¨¡å¼è³‡æ–™
    async function loadModes() {
        try {
            const response = await fetch(`${API_BASE_URL}/modes`);
            const result = await response.json();
            
            if (result.success && result.data.length > 0) {
                result.data.forEach((mode, index) => {
                    const modeNum = index + 1;
                    const nameInput = document.getElementById(`mode-name-${modeNum}`);
                    const codeInput = document.getElementById(`mode-code-${modeNum}`);
                    
                    if (nameInput && mode.name) {
                        nameInput.value = mode.name;
                    }
                    if (codeInput && mode.code) {
                        codeInput.value = mode.code;
                    }
                });
                console.log('âœ… å·²è¼‰å…¥æ¨¡å¼è³‡æ–™');
            }
        } catch (error) {
            console.warn('âš ï¸ ç„¡æ³•è¼‰å…¥æ¨¡å¼è³‡æ–™:', error.message);
        }
    }

    // å„²å­˜æ¨¡å¼æŒ‰éˆ•äº‹ä»¶
    document.getElementById('save-modes-button').addEventListener('click', async function() {
        const modes = [];
        
        // æ”¶é›†æ‰€æœ‰æ¨¡å¼è³‡æ–™
        for (let i = 1; i <= 3; i++) {
            const name = document.getElementById(`mode-name-${i}`).value.trim();
            const code = document.getElementById(`mode-code-${i}`).value.trim();
            
            if (name) {
                modes.push({
                    name: name,
                    code: code || '',
                    description: `${name}æ¨¡å¼`,
                    order: i
                });
            }
        }
        
        if (modes.length === 0) {
            showMessage('âš ï¸ è«‹è‡³å°‘å¡«å¯«ä¸€å€‹æ¨¡å¼åç¨±');
            return;
        }
        
        try {
            // å…ˆåˆªé™¤æ‰€æœ‰ç¾æœ‰æ¨¡å¼,å†æ‰¹æ¬¡æ–°å¢
            const deleteResponse = await fetch(`${API_BASE_URL}/modes`, {
                method: 'DELETE'
            });
            
            // æ‰¹æ¬¡æ–°å¢æ¨¡å¼
            const savePromises = modes.map(mode => 
                fetch(`${API_BASE_URL}/modes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(mode)
                })
            );
            
            const responses = await Promise.all(savePromises);
            const results = await Promise.all(responses.map(r => r.json()));
            
            const successCount = results.filter(r => r.success).length;
            
            if (successCount > 0) {
                showMessage(`âœ… æˆåŠŸå„²å­˜ ${successCount} å€‹æ¨¡å¼ï¼`);
                // é‡æ–°è¼‰å…¥è€ƒé¡Œåˆ†æ´¾çš„æ¨¡å¼é¸å–®
                loadAssignmentData();
            } else {
                showMessage('âŒ å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        } catch (error) {
            showMessage('âŒ å„²å­˜å¤±æ•—ï¼š' + error.message);
            console.error('å„²å­˜æ¨¡å¼éŒ¯èª¤:', error);
        }
    });

    // Initial Tab Setup: Set 'è€ƒé¡Œåˆ†æ´¾' as active on load and render questions for 'è€ƒé¡Œç®¡ç†'
    window.onload = function() {
        // Set 'è€ƒé¡Œåˆ†æ´¾' as the initial active tab
        document.querySelector('.tab-button[data-tab="assignment"]').click();
        
        // é å…ˆè¼‰å…¥è€ƒé¡Œè³‡æ–™
        fetchQuestions();
        
        // è¼‰å…¥è€ƒé¡Œåˆ†æ´¾è³‡æ–™
        loadAssignmentData();
        
        // è¼‰å…¥æ¨¡å¼ç®¡ç†è³‡æ–™
        loadModes();
        
        // Initialize all icons
        lucide.createIcons();
    }
</script>

</body>
</html>